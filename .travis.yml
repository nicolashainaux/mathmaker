sudo: required
language: python
services: docker
python:
    - "3.6"
cache:
    - pip3
# blocklist
branches:
  except:
    - broken
before_install:
    - docker build -t nicolashainaux/mathmaker .
    - docker run --name affectionate_carson nicolashainaux/mathmaker
    - docker cp mathmaker/ affectionate_carson:/
    - docker start affectionate_carson && docker exec affectionate_carson /bin/bash -c "pip3 install --force -r /mathmaker/requirements.txt --extra-index-url https://mirror.picosecond.org/pypi/simple"
install:
    - pip3 install coveralls
script:
    - docker start affectionate_carson && docker exec affectionate_carson /bin/bash -c "cd /mathmaker && coverage run --source=mathmaker setup.py test"
after_success:
    - docker cp affectionate_carson:/mathmaker/.coverage /mathmaker/.coverage
    - coveralls
    # - coverage combine
    # - docker start affectionate_carson && docker exec -e CI="$CI" -e TRAVIS="$TRAVIS" -e CONTINUOUS_INTEGRATION="$CONTINUOUS_INTEGRATION" -e DEBIAN_FRONTEND="$DEBIAN_FRONTEND" -e USER="$USER" -e TRAVIS_BUILD_NUMBER="$TRAVIS_BUILD_NUMBER" -e TRAVIS_JOB_ID="$TRAVIS_JOB_ID" -e TRAVIS_BRANCH="$TRAVIS_BRANCH" affectionate_carson /bin/bash -c "ls -al /build/ && coveralls -d /build/.coverage -b /build/"
